---
title: æ¸…ç†
description: æ¸…ç†
---

import firstAppJsCode from "./code/first/App.js.example";
import firstMouseTrackerJsCode from "./code/first/MouseTracker.js.example";
import firstStylesCssCode from "./code/first/styles.css.example";
import secondAppJsCode from "./code/second/App.js.example";
import secondMouseTrackerJsCode from "./code/second/MouseTracker.js.example";
import secondStylesCssCode from "./code/second/styles.css.example";

<Accordions>

<Accordion title='è§†é¢‘æ‘˜è¦' >

æˆ‘ä»¬ä¸€ç›´åœ¨å­¦ä¹ å¦‚ä½•åœ¨æŒ‚è½½æ—¶ä½¿ç”¨ useEffect é’©å­å¯åŠ¨é•¿æ—¶é—´è¿è¡Œçš„è¿›ç¨‹ï¼Œä½†åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆè¿˜ä¸å®Œæ•´ï¼

ä¸ºäº†å±•ç¤ºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ›´æ–°äº†â€œåœ¨æŒ‚è½½æ—¶è¿è¡Œâ€è¯¾ç¨‹ä¸­çš„é¼ æ ‡è¿½è¸ªç¤ºä¾‹ï¼Œä½¿å…¶å¯ä»¥æœ‰æ¡ä»¶åœ°æ¸²æŸ“ï¼š

```jsx
function App() {
  const [isTrackingMouse, setIsTrackingMouse] = React.useState(true);

  function toggleMouseTracking() {
    setIsTrackingMouse(!isTrackingMouse);
  }

  return (
    <div className="wrapper">
      <button onClick={toggleMouseTracking}>Toggle Mouse Tracking</button>
      //[!code highlight]
      {isTrackingMouse && <MouseTracker />}
    </div>
  );
}
```

å½“ isTrackingMouse æ˜¯ä¸€ä¸ªçœŸå€¼æ—¶ï¼Œæˆ‘ä»¬æŒ‚è½½ç»„ä»¶ã€‚æ­£å¦‚æˆ‘ä»¬åœ¨â€œç»„ä»¶å®ä¾‹â€è¯¾ç¨‹ä¸­æ‰€å­¦ï¼Œè¿™ä¼šåˆ›å»ºä¸€ä¸ªç»„ä»¶å®ä¾‹ï¼Œä¸€ä¸ªç”¨äºå­˜å‚¨ä¸ç»„ä»¶ç›¸å…³æ•°æ®çš„åœ°æ–¹ã€‚

å½“ isTrackingMouse ä¸ºå‡æ—¶ï¼Œæˆ‘ä»¬å¸è½½ç»„ä»¶ï¼Œé”€æ¯å®ä¾‹å¹¶ç§»é™¤æ‰€æœ‰ç›¸å…³çš„ DOM èŠ‚ç‚¹ã€‚

å› æ­¤ï¼Œäººä»¬ç›´è§‰ä¸Šä¼šè®¤ä¸ºï¼Œå¦‚æœç»„ä»¶å¸è½½ï¼Œä»»ä½•æ®‹ç•™çš„Effectä¹Ÿä¼šè¢«ä¸­æ–­ï¼Œä½†ä¸å¹¸çš„æ˜¯ï¼Œäº‹å®å¹¶éå¦‚æ­¤ã€‚

æˆ‘ä»¬çš„ MouseTracker ç»„ä»¶è®¾ç½®äº†ä»¥ä¸‹Effectï¼š

```jsx
React.useEffect(() => {
  function handleMouseMove(event) {
    setMousePosition({
      x: event.clientX,
      y: event.clientY,
    });
  }

  window.addEventListener("mousemove", handleMouseMove);
}, []);
```

å½“ç»„ä»¶å¸è½½æ—¶ï¼Œäº‹ä»¶ç›‘å¬å™¨ä»ç„¶å­˜åœ¨ï¼Œè·Ÿè¸ªå…‰æ ‡ä½ç½®å¹¶åœ¨ä¸€ä¸ªä¸åº”è¯¥å†å­˜åœ¨çš„ç»„ä»¶å®ä¾‹ä¸Šè°ƒç”¨ setMousePosition ï¼

è¿™æœ‰ä¸¤ä¸ªåŸå› ï¼š

1. æ¯æ¬¡ç»„ä»¶é‡æ–°æŒ‚è½½æ—¶ï¼Œå¦ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨å°†è¢«æ·»åŠ ï¼Œè€Œä¹‹å‰çš„ç›‘å¬å™¨ä¸ä¼šè¢«ç§»é™¤ã€‚
2. å› ä¸ºæˆ‘ä»¬æ­£åœ¨å¼•ç”¨ç»„ä»¶å®ä¾‹çš„ä¸€éƒ¨åˆ†ï¼ˆé€šè¿‡è°ƒç”¨ setMousePosition ï¼‰ï¼ŒJavaScript åƒåœ¾æ”¶é›†å™¨æ— æ³•æ¸…ç†è¿™ä¸ªå®ä¾‹ï¼è¿™æ„å‘³ç€æ¯æ¬¡æˆ‘ä»¬æŒ‚è½½è¿™ä¸ªç»„ä»¶æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªå°†æ°¸è¿œä¸ä¼šè¢«åˆ é™¤çš„å®ä¾‹ã€‚

è¿™è¢«ç§°ä¸ºå†…å­˜æ³„æ¼ã€‚ç”¨æˆ·ä½¿ç”¨æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„æ—¶é—´è¶Šé•¿ï¼Œæ¶ˆè€—çš„å†…å­˜å°±è¶Šå¤šã€‚å¦‚æœç”¨æˆ·åˆ·æ–°é¡µé¢ï¼Œå†…å­˜å°†è¢«é‡Šæ”¾ï¼Œä½†äººä»¬å¾€å¾€ä¼šè®©åŒä¸€æ ‡ç­¾é¡µè¿è¡Œæ•°å‘¨æˆ–æ•°æœˆä¸ç­‰ï¼

ä¸ºä»€ä¹ˆäº‹ä»¶ç›‘å¬å™¨æ²¡æœ‰è‡ªåŠ¨ç§»é™¤ï¼Ÿäº‹æƒ…æ˜¯è¿™æ ·çš„ï¼šReact å®é™…ä¸Šä¸çŸ¥é“æˆ‘ä»¬çš„ effect å‡½æ•°å†…éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆï¼š

```jsx
// What React sees:
React.useEffect(() => {
  ????
}, []);
```

React å‘ç°æˆ‘ä»¬ç»™äº†å®ƒä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”æˆ‘ä»¬æŒ‡å®šäº†ä½•æ—¶è°ƒç”¨å®ƒï¼ˆé€šè¿‡ä¾èµ–æ•°ç»„ï¼‰ï¼Œä½† React æ— æ³•â€œçœ‹ç©¿â€è¿™ä¸ªå‡½æ•°ï¼å®ƒä¸çŸ¥é“æˆ‘ä»¬å·²ç»å¯åŠ¨äº†ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼Œå› ä¸ºäº‹ä»¶ç›‘å¬çš„å†…å®¹æ˜¯ DOM çš„ä¸€éƒ¨åˆ†ã€‚

åŒæ ·ï¼Œè¿è¡Œæˆ‘ä»¬äº‹ä»¶ç›‘å¬å™¨çš„ JavaScript å¼•æ“å¹¶ä¸çŸ¥é“å®ƒæ˜¯åœ¨ä¸€ä¸ªç»„ä»¶å®ä¾‹å†…åˆ›å»ºçš„ï¼Œä¹Ÿä¸çŸ¥é“å®ƒåº”è¯¥ä¾èµ–äºè¯¥å®ä¾‹çš„å­˜åœ¨ã€‚

æœ¬è´¨ä¸Šï¼Œæˆ‘ä»¬è¿™é‡Œæœ‰ä¸¤ä¸ªç‹¬ç«‹çš„ç³»ç»Ÿï¼Œåè°ƒå®ƒä»¬çš„å·¥ä½œç”±æˆ‘ä»¬æ¥å†³å®šã€‚

å¹¸è¿çš„æ˜¯ï¼Œ useEffect é™„å¸¦äº†ä¸€ç§å·¥å…·æ¥å®ç°è¿™ä¸€ç‚¹ï¼šæ¸…ç†å‡½æ•°ã€‚

è¿™çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š

```jsx
React.useEffect(() => {
  function handleMouseMove(event) {
    setMousePosition({
      x: event.clientX,
      y: event.clientY,
    });
  }

  window.addEventListener("mousemove", handleMouseMove);

  return () => {
    window.removeEventListener("mousemove", handleMouseMove);
  };
}, []);
```

åœ¨æˆ‘ä»¬çš„Effectå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬è¿”å›ä¸€ä¸ªåŒ…å«è¦å®Œæˆçš„æ¸…ç†å·¥ä½œçš„å‡½æ•°ã€‚React ä¼šä¿ç•™è¿™ä¸ªå‡½æ•°ï¼Œå¹¶åœ¨é€‚å½“çš„æ—¶æœºè°ƒç”¨å®ƒï¼šåœ¨ç»„ä»¶å¸è½½ä¹‹å‰ã€‚

è¿™é€šå¸¸æ˜¯ä»»ä½•è®¢é˜…/é•¿æ—¶é—´è¿è¡Œè¿‡ç¨‹çš„æ¨¡å¼ã€‚æˆ‘ä»¬åœ¨Effectå‡½æ•°ä¸­è®¢é˜…ï¼Œå¹¶åœ¨æ¸…ç†å‡½æ•°ä¸­å–æ¶ˆè®¢é˜…ã€‚React ä¼šåœ¨ç»„ä»¶å¸è½½ä¹‹å‰è°ƒç”¨æ¸…ç†å‡½æ•°ï¼Œåœæ­¢è¯¥è¿‡ç¨‹å¹¶ç¡®ä¿æˆ‘ä»¬ä¸ä¼šå‡ºç°å†…å­˜æ³„æ¼ã€‚

</Accordion>

</Accordions>

åœ¨æœ€åä¸€ä¸ªæ¨¡å—ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†ç»„ä»¶å®ä¾‹ï¼Œä»¥åŠå¦‚ä½•æœ‰æ¡ä»¶åœ°æ¸²æŸ“ç»„ä»¶ä¼šåˆ›å»ºå’Œé”€æ¯è¿™äº›å®ä¾‹ã€‚å¦‚æœä½ å¯¹è¿™ä¸ªæ¦‚å¿µä»ç„¶æ„Ÿåˆ°æ¨¡ç³Šï¼Œå¯ä»¥å›é¡¾æ¨¡å— 2 ä¸­çš„â€œç»„ä»¶å®ä¾‹â€è¯¾ç¨‹ã€‚

è¿™æ˜¯è§†é¢‘ä¸­çš„æ²™ç›’ï¼Œæ·»åŠ äº†æ¸…ç†åŠŸèƒ½ï¼š

<Sandpack
  files={{
    "App.js": firstAppJsCode,
    "MouseTracker.js": firstMouseTrackerJsCode,
    "styles.css": { code: firstStylesCssCode, hidden: true },
  }}
  template="react"
/>

<Callout type='info' title='è¿”å›å‡½æ•°çš„å‡½æ•° ğŸ˜¬'>

åœ¨æˆ‘èŒä¸šç”Ÿæ¶¯æ—©æœŸï¼Œè®©æˆ‘æ„Ÿåˆ°æœ€å›°æƒ‘çš„äº‹æƒ…ä¹‹ä¸€å°±æ˜¯å‡½æ•°è¿”å›å‡½æ•°ã€‚è¿™ç§äº‹æƒ…è®©æˆ‘æ„Ÿåˆ°å¤´ç—›ï¼š

```jsx
function doSomething() {
  const hi = 5;

  return function () {
    return hi * 2;
  };
}
```

è¿™é‡Œå‘ç”Ÿçš„äº‹æƒ…ä¸ useEffect æ¸…ç† API ç±»ä¼¼ã€‚æˆ‘ä»¬çš„ä¸»è¦Effectå‡½æ•°è¿”å›ä¸€ä¸ªå‡½æ•°ï¼š

```jsx
React.useEffect(() => {
  // Effect logic here

  // Cleanup function:
  return () => {
    // Cleanup logic here
  };
});
```

å¥½æ¶ˆæ¯æ˜¯ï¼šè¿™å®é™…ä¸Šæ›´å¤šçš„æ˜¯ä¸€ä¸ªå®ç°ç»†èŠ‚ã€‚æˆ‘ä»¬ä¸éœ€è¦åœ¨è¿™ä¸ªå¥‡æ€ªçš„è¯­æ³•ä¸Šè¿‡äºçº ç»“ã€‚

æœ€é‡è¦çš„æ˜¯ä½ è¦ç†è§£åŸºæœ¬çš„æ¦‚å¿µï¼šæˆ‘ä»¬ç»™ React ä¸¤ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªæ˜¯Effectå‡½æ•°ï¼Œä¸€ä¸ªæ˜¯æ¸…ç†å‡½æ•°ï¼ŒReact åœ¨é€‚å½“çš„æ—¶æœºä¸ºæˆ‘ä»¬è°ƒç”¨è¿™äº›å‡½æ•°ã€‚

è¯è™½å¦‚æ­¤ï¼Œè®¾ç½®æˆè¿™æ ·ç¡®å®æœ‰å…¶åˆç†ä¹‹å¤„ã€‚å¦‚æœä½ æ„Ÿå…´è¶£ï¼Œå¯ä»¥å±•å¼€è¿™ä¸ªæ—æ³¨æ·±å…¥äº†è§£ï¼š

<Accordions>

<Accordion title='å±•å¼€æŸ¥çœ‹æ›´å¤š' >

å‡è®¾æˆ‘ä»¬æœ‰ä¸€æ ¹é­”æ³•æ£’ ğŸª„ï¼Œå¯ä»¥éšå¿ƒæ‰€æ¬²åœ°æ”¹å˜ React APIã€‚

å”¯ä¸€çš„ç¡¬æ€§è¦æ±‚æ˜¯å¼€å‘è€…éœ€è¦èƒ½å¤Ÿæä¾›ä¸¤ä¸ªä¸åŒçš„åŠŸèƒ½ï¼š

- ä¸»è¦Effectå‡½æ•°
- æ¸…ç†å‡½æ•°

æ»¡è¶³è¿™äº›è¦æ±‚æœ‰å¾ˆå¤šæ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶ç»“æ„è®¾è®¡ä¸ºè¿™æ ·ï¼š

```jsx
React.useEffect(
  {
    effect: () => {
      // Effect logic
    },

    cleanup: () => {
      // Cleanup logic
    },
  },
  [],
);
```

åœ¨è¿™ä¸ªå‡è®¾çš„æ›¿ä»£æ–¹æ¡ˆä¸­ï¼Œ useEffect æ¥å—ä¸€ä¸ªå…·æœ‰ä¸¤ä¸ªç‹¬ç«‹æ–¹æ³•çš„å¯¹è±¡ï¼šä¸€ä¸ªç”¨äºEffectï¼Œä¸€ä¸ªç”¨äºæ¸…ç†ã€‚

æˆ‘ä¸çŸ¥é“ä½ æ€ä¹ˆæƒ³ï¼Œä½†å¯¹æˆ‘æ¥è¯´ï¼Œè¿™ä¼¼ä¹æ›´å®¹æ˜“ç†è§£ã€‚ç„¶è€Œï¼Œä¸å¹¸çš„æ˜¯ï¼Œå®ƒå¹¶ä¸å¥æ•ˆã€‚ğŸ˜¬

çœ‹çœ‹ä½ æ˜¯å¦èƒ½å‘ç°é—®é¢˜ï¼Œä¸€æ—¦æˆ‘ä»¬ç”¨é¼ æ ‡è¿½è¸ªè§£å†³æ–¹æ¡ˆå¡«å……å®ƒï¼š

```jsx
React.useEffect(
  {
    effect: () => {
      function handleMouseMove(event) {
        setMousePosition({
          x: event.clientX,
          y: event.clientY,
        });
      }

      window.addEventListener("mousemove", handleMouseMove);
    },

    cleanup: () => {
      window.removeEventListener("mousemove", handleMouseMove);
    },
  },
  [],
);
```

å¦‚æœ React å®é™…ä¸Šæ˜¯ä»¥è¿™ç§æ–¹å¼æ„å»ºçš„ï¼Œå¹¶ä¸”æˆ‘ä»¬æŒ‰åŸæ ·è¿è¡Œè¿™æ®µä»£ç ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªé”™è¯¯ï¼š

<Callout type='error'>

Uncaught ReferenceError: handleMouseMove is not defined.
æœªæ•è·çš„å¼•ç”¨é”™è¯¯ï¼šhandleMouseMove æœªå®šä¹‰ã€‚

</Callout>

æˆ‘ä»¬æ­£åœ¨å®šä¹‰ä¸€ä¸ª handleMouseMove å‡½æ•°ï¼Œä½†å®ƒçš„ä½œç”¨åŸŸä»…é™äº effect å‡½æ•°ã€‚æˆ‘ä»¬çš„æ¸…ç†å‡½æ•°æ— æ³•è®¿é—®å®ƒï¼

è¿™é‡Œæœ‰ä¸€ä¸ªæ›´ç®€å•çš„ä¾‹å­ï¼Œæ˜¾ç¤ºäº†åŒæ ·çš„é—®é¢˜ï¼š

```jsx
const someObject = {
  effect: () => {
    const hi = 5;
  },
  cleanup: () => {
    console.log(hi); // Uncaught ReferenceError: hi is not defined
  },
};
```

æˆ‘ä»¬çš„æ¸…ç†å‡½æ•°éœ€è¦è®¿é—®åœ¨Effectå‡½æ•°ä¸­åˆ›å»ºçš„å†…å®¹æ˜¯éå¸¸å¸¸è§çš„ã€‚

å†çœ‹çœ‹å®˜æ–¹å®ç°ï¼Œæˆ‘ä»¬çœ‹åˆ°å®ƒå…è®¸æ¸…ç†å‡½æ•°è®¿é—®åœ¨Effectä¸­åˆ›å»ºçš„æ‰€æœ‰å˜é‡/å‡½æ•°ï¼š

```jsx
React.useEffect(() => {
  function handleMouseMove(event) {
    setMousePosition({
      x: event.clientX,
      y: event.clientY,
    });
  }

  window.addEventListener("mousemove", handleMouseMove);

  return () => {
    // We have access to `handleMouseMove` because it's
    // defined in the parent scope!
    window.removeEventListener("mousemove", handleMouseMove);
  };
}, []);
```

è¿™å°±æ˜¯ React å›¢é˜Ÿé€‰æ‹©è¿™ç§æ–¹æ³•çš„åŸå› â€”â€”ä»–ä»¬å¹¶ä¸æ˜¯åœ¨ç‚«è€€ä»–ä»¬çš„å‡½æ•°å¼ç¼–ç¨‹æŠ€èƒ½ï¼

å¦‚ä¸Šæ‰€è¿°ï¼Œè¿™æ˜¯ä¸€é¡¹å®ç°ç»†èŠ‚ï¼Œå¹¶ä¸æ˜¯æˆ‘ä»¬éœ€è¦è¿‡äºæ‹…å¿ƒçš„äº‹æƒ…ã€‚

</Accordion>

</Accordions>

</Callout>

## æ¸…ç†ä¸ä¾èµ–é¡¹

<Accordions>

<Accordion title='è§†é¢‘æ‘˜è¦' >

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°å¦‚ä½•å¯åŠ¨å’Œåœæ­¢ä¸ç»„ä»¶ç”Ÿå‘½å‘¨æœŸç›¸å…³çš„é•¿æ—¶é—´è¿è¡Œçš„Effectã€‚ä½†å¦‚æœæˆ‘ä»¬çš„Effectæœ‰ä¾èµ–é¡¹å‘¢ï¼Ÿå®ƒä»¬å¦‚ä½•ä¸è¿™ä¸ªæ¸…ç†å‡½æ•°äº¤äº’ï¼Ÿ

è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªæ›´æ–°çš„ä¾‹å­ã€‚ä¸å…¶è®©ä¸€ä¸ªçˆ¶ç»„ä»¶æŒ‚è½½/å¸è½½ MouseTracker ç»„ä»¶ï¼Œä¸å¦‚ä¸€åˆ‡éƒ½åœ¨ç»„ä»¶å†…éƒ¨å‘ç”Ÿï¼Ÿ

è¿™æ˜¯æ–°ä»£ç ï¼š

```jsx
import React from "react";

function MouseTracker() {
  const [mousePosition, setMousePosition] = React.useState({
    x: 0,
    y: 0,
  });
  const [isEnabled, setIsEnabled] = React.useState(true);

  React.useEffect(() => {
    function handleMouseMove(event) {
      setMousePosition({
        x: event.clientX,
        y: event.clientY,
      });
    }

    window.addEventListener("mousemove", handleMouseMove);

    return () => {
      window.removeEventListener("mousemove", handleMouseMove);
    };
  }, []);

  function toggleMouseTracking() {
    setIsEnabled(!isEnabled);
  }

  return (
    <>
      <button onClick={toggleMouseTracking}>Toggle Mouse Tracking</button>
      <p>
        {mousePosition.x} / {mousePosition.y}
      </p>
    </>
  );
}

export default MouseTracker;
```

æœ¬è´¨ä¸Šï¼Œæˆ‘æƒ³åœ¨ isEnabled ä¸º true æ—¶æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨ï¼Œå¹¶åœ¨ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æ—¶æ³¨é”€å®ƒï¼Œå°† isEnabled ç¿»è½¬ä¸º false ã€‚

å½“æˆ‘åˆšå¼€å§‹æ¥è§¦ç‰¹æ•ˆæ—¶ï¼Œæˆ‘çš„ç›´è§‰æ˜¯åšä¸€äº›åƒè¿™æ ·çš„äº‹æƒ…ï¼š

```jsx
if (isEnabled) {
  React.useEffect(() => {
    function handleMouseMove(event) {
      setMousePosition({
        x: event.clientX,
        y: event.clientY,
      });
    }

    window.addEventListener("mousemove", handleMouseMove);

    return () => {
      window.removeEventListener("mousemove", handleMouseMove);
    };
  }, []);
}
```

å¯¹æˆ‘æ¥è¯´ï¼Œæœ‰æ¡ä»¶åœ°è°ƒç”¨ useEffect é’©å­æ˜¯éå¸¸æœ‰é“ç†çš„ã€‚ä¸å¹¸çš„æ˜¯ï¼Œæ­£å¦‚æˆ‘ä»¬æ‰€äº†è§£åˆ°çš„ï¼Œè¿™è¿åäº†â€œé’©å­è§„åˆ™â€ã€‚æˆ‘ä»¬ä¸å…è®¸æœ‰æ¡ä»¶åœ°è°ƒç”¨ä»»ä½•é’©å­ã€‚

å¥½å§ï¼Œå—¯ã€‚å¦‚æœæˆ‘ä»¬åƒè¿™æ ·å°† if æ¡ä»¶ç§»åˆ°é’©å­å†…å‘¢ï¼Ÿ

```jsx
React.useEffect(() => {
  if (isEnabled) {
    function handleMouseMove(event) {
      setMousePosition({
        x: event.clientX,
        y: event.clientY,
      });
    }

    window.addEventListener("mousemove", handleMouseMove);

    return () => {
      window.removeEventListener("mousemove", handleMouseMove);
    };
  }
}, []);
```

å¦‚æœæˆ‘ä»¬è¿è¡Œè¿™æ®µä»£ç ï¼Œæˆ‘ä»¬ä¼šæ”¶åˆ°ä¸€ä¸ªä¸åŒçš„ lint è­¦å‘Šï¼šæˆ‘ä»¬ç¼ºå°‘ä¸€ä¸ªä¾èµ–é¡¹ï¼å°±åƒæˆ‘ä»¬åœ¨ Effect Lint Rules è¯¾ä¸Šçœ‹åˆ°çš„é‚£æ ·ï¼Œæˆ‘ä»¬éœ€è¦å°†æ‰€æœ‰çŠ¶æ€å˜é‡æ·»åŠ åˆ°ä¾èµ–æ•°ç»„ä¸­ã€‚

å½“æˆ‘ä»¬å°† isEnabled æ·»åŠ åˆ°ä¾èµ–æ•°ç»„ä¸­æ—¶ï¼Œæˆ‘ä»¬è§£å†³äº†æ‰€æœ‰çš„ lint è­¦å‘Šâ€¦â€¦è€Œä¸”æˆ‘ä»¬ä¹Ÿè§£å†³äº†é—®é¢˜ï¼

```jsx
// âœ… This code does exactly what we want!
React.useEffect(() => {
  if (isEnabled) {
    function handleMouseMove(event) {
      setMousePosition({
        x: event.clientX,
        y: event.clientY,
      });
    }

    window.addEventListener("mousemove", handleMouseMove);

    return () => {
      window.removeEventListener("mousemove", handleMouseMove);
    };
  }
}, [isEnabled]);
```

è¿™åˆ°åº•æ˜¯æ€ä¹ˆå·¥ä½œçš„å‘¢ï¼Ÿ

ï¼ˆè¿™ä¸€éƒ¨åˆ†å¾ˆéš¾æ€»ç»“ï¼Œæˆ‘å»ºè®®è§‚çœ‹/é‡æ¸©è§†é¢‘ï¼ï¼‰

- å½“ç»„ä»¶æŒ‚è½½æ—¶ï¼Œæˆ‘ä»¬è¿è¡ŒEffectï¼Œæ³¨å†Œäº‹ä»¶ç›‘å¬å™¨ï¼Œå¹¶å°†æ¸…ç†å‡½æ•°äº¤ç»™ Reactï¼Œå°±åƒç­‰å¾…æ‰“å¼€çš„ç¤¼ç‰©
- å½“ç”¨æˆ·ç§»åŠ¨é¼ æ ‡æ—¶ï¼Œ mousePosition çŠ¶æ€å°†å¿«é€Ÿæ›´æ–°ï¼Œä½†Effectä¸ä¼šé‡æ–°è¿è¡Œï¼Œå› ä¸º mousePosition ä¸æ˜¯ä¸€ä¸ªä¾èµ–é¡¹ã€‚
- å¦‚æœç”¨æˆ·ç‚¹å‡»æŒ‰é’®ï¼Œ isEnabled å°†å˜ä¸º falseã€‚ç”±äº isEnabled æ˜¯ä¸€ä¸ªä¾èµ–é¡¹ï¼Œè¿™æ„å‘³ç€Effectå°†é‡æ–°è¿è¡Œã€‚
- ä¸è¿‡ï¼Œé¦–å…ˆï¼ŒReact ä¼šè°ƒç”¨æ¸…ç†å‡½æ•°ï¼
- äº‹ä»¶ç›‘å¬å™¨è¢«ç§»é™¤ï¼Œå› ä¸º isEnabled æ˜¯ false ï¼Œæ‰€ä»¥Effectæ˜¯æ— æ“ä½œã€‚
- æ¯æ¬¡ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œè¿™ä¸ªè¿‡ç¨‹éƒ½ä¼šé‡å¤ã€‚

è¿™é‡Œçš„å…³é”®æŠ€å·§æ˜¯Effectå¹¶ä¸æ„å‘³ç€â€œå åŠ â€ã€‚åœ¨ React é‡æ–°è¿è¡ŒEffectä¹‹å‰ï¼Œå®ƒä¼šè°ƒç”¨ç¼“å­˜çš„æ¸…ç†å‡½æ•°ï¼Œä»¥ç¡®ä¿æˆ‘ä»¬ä»â€œå¹²å‡€çš„çŠ¶æ€â€å¼€å§‹ã€‚

è§†é¢‘ä»¥å‡ ä¸ªå›¾è¡¨ç»“æŸï¼Œè¯´æ˜äº†è¿™ä¸ªæ¦‚å¿µã€‚å®ƒä»¬å¯ä»¥åœ¨ä¸‹é¢æŸ¥çœ‹ï¼š

</Accordion>

</Accordions>

ä»¥ä¸‹æ˜¯è§†é¢‘ä¸­çš„å›¾è¡¨ï¼š

è¿ç®—é¡ºåºï¼š

![effect-table](/react/module3/effect-table.svg)

å¿«ç…§å’Œæ¸…ç†çš„è§†å›¾ï¼š

![effect-cleanup-timeline](/react/module3/effect-cleanup-timeline.svg)

æ¸…ç†å‡½æ•°å¹¶ä¸æ€»æ˜¯æä¾›ï¼š

![effect-cleanup-timeline-missing-cleanups](/react/module3/effect-cleanup-timeline-missing-cleanups.svg)

æœ€åï¼Œè¿™æ˜¯è§†é¢‘ä¸­çš„æ²™ç›’ã€‚æˆ‘è°ƒæ•´äº†æŒ‰é’®çš„æ–‡æœ¬ï¼Œä½¿å…¶æ›´æ¸…æ™°ä¸€äº›ï¼š

<Sandpack
  files={{
    "App.js": { code: secondAppJsCode, hidden: true },
    "MouseTracker.js": secondMouseTrackerJsCode,
    "styles.css": { code: secondStylesCssCode, hidden: true },
  }}
  template="react"
/>

<Callout type='info' title='React 19 ä¸­çš„ refs å’Œæ¸…ç†å‡½æ•°'>

ä» React 19 å¼€å§‹ï¼Œæˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„ ref å±æ€§ä¹Ÿå¯ä»¥æä¾›ä¸€ä¸ªæ¸…ç†å‡½æ•°ï¼š

```jsx
<input
  ref={(element) => {
    // This callback will be called on every render

    return () => {
      // This cleanup function will be called right before
      // every re-render, and when the element is destroyed.
    };
  }}
/>
```

å°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œæˆ‘è¿˜æ²¡æœ‰æ‰¾åˆ°è¿™ä¸ªçš„ç”¨é€”ã€‚ä¸ useEffect ä¸åŒï¼Œref å›è°ƒä¸èƒ½ç»™å®šä¾èµ–æ•°ç»„ï¼Œè¿™æ„å‘³ç€ ref å›è°ƒ + æ¸…ç†æ¯æ¬¡éƒ½ä¼šè§¦å‘ã€‚

è¯è™½å¦‚æ­¤ï¼Œè¿™æ˜¯ä¸€é¡¹éå¸¸æ–°çš„å˜åŒ–ï¼Œä¹Ÿè®¸æˆ‘è¿˜æ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„ä½¿ç”¨æ¡ˆä¾‹ã€‚è¯·éšæ„å°è¯•ï¼

æ‚¨å¯ä»¥åœ¨ [React 19 è¡¥ä¸è¯´æ˜](https://react.dev/blog/2024/12/05/react-19#cleanup-functions-for-refs)ä¸­äº†è§£æ›´å¤šä¿¡æ¯ã€‚

</Callout>
